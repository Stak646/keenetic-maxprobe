#!/bin/sh
set -eu
INITD="/opt/etc/init.d"
usage(){ echo "Usage: entwarectl {list|start|stop|restart|status|logs} [service]"; exit 2; }
cmd="${1:-}"; svc="${2:-}"
[ -n "$cmd" ] || usage
case "$cmd" in
  list) ls -1 "$INITD" 2>/dev/null | sed 's/^S[0-9][0-9]//' ;;
  start|stop|restart|status)
    [ -n "$svc" ] || usage
    script="$(ls -1 "$INITD" 2>/dev/null | grep -E "^[SK]?[0-9]{2}.*$svc" | head -n 1 || true)"
    [ -n "$script" ] || { echo "Service not found: $svc"; exit 1; }
    "$INITD/$script" "$cmd" || true
    ;;
  logs)
    [ -n "$svc" ] || usage
    for p in /opt/var/log/"$svc"* /opt/var/log/*"$svc"*; do
      [ -f "$p" ] && { echo "== $p =="; tail -n 200 "$p" 2>/dev/null || true; }
    done
    ;;
  *) usage ;;
esac
